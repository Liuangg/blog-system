# åšå®¢ç³»ç»Ÿ API æ–‡æ¡£

> åŸºç¡€åœ°å€ï¼š`http://127.0.0.1:5000`  
> æœ€åæ›´æ–°ï¼š2026-02-15

---

## ğŸ“Œ é€šç”¨è¯´æ˜

### è¯·æ±‚æ ¼å¼
- Content-Type: `application/json`

### è®¤è¯æ–¹å¼
éœ€è¦ç™»å½•çš„æ¥å£ï¼ˆæ ‡æœ‰ ğŸ”’ï¼‰ï¼Œè¯·åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ï¼š
```
Authorization: Bearer <token>
```

### ç»Ÿä¸€å“åº”æ ¼å¼

**æˆåŠŸå“åº”ï¼š**
```json
{
    "message": "æ“ä½œæˆåŠŸ",
    "data": { ... }
}
```

**é”™è¯¯å“åº”ï¼š**
```json
{
    "error": "é”™è¯¯æè¿°ä¿¡æ¯",
    "detail": "è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"
}
```

### HTTP çŠ¶æ€ç 
| çŠ¶æ€ç  | å«ä¹‰ |
|--------|------|
| 200 | è¯·æ±‚æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªç™»å½•/Tokenæ— æ•ˆ |
| 403 | æ— æƒé™æ“ä½œ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 409 | èµ„æºå†²çªï¼ˆå¦‚ç”¨æˆ·å/é‚®ç®±å·²æ³¨å†Œï¼‰|
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## ğŸ¥ å¥åº·æ£€æŸ¥

### GET /api/health
æ£€æµ‹æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚

**å“åº”ç¤ºä¾‹ (200)ï¼š**
```json
{
    "message": "åšå®¢ç³»ç»Ÿ API è¿è¡Œæ­£å¸¸"
}
```

---

## ğŸ‘¤ ç”¨æˆ·æ¨¡å—

### POST /api/users/register
ç”¨æˆ·æ³¨å†Œã€‚

**è¯·æ±‚ä½“ï¼š**
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | âœ… | ç”¨æˆ·åï¼ˆ2~50å­—ç¬¦ï¼Œå­—æ¯/æ•°å­—/ä¸‹åˆ’çº¿/ä¸­æ–‡ï¼‰ |
| email | string | âœ… | é‚®ç®± |
| password | string | âœ… | å¯†ç ï¼ˆ6~128å­—ç¬¦ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "username": "zhangsan",
    "email": "zhangsan@example.com",
    "password": "123456"
}
```

**æˆåŠŸå“åº” (201)ï¼š**
```json
{
    "message": "æ³¨å†ŒæˆåŠŸ",
    "data": {
        "user": {
            "id": 1,
            "username": "zhangsan",
            "email": "zhangsan@example.com"
        }
    }
}
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 400 | ç”¨æˆ·å/é‚®ç®±/å¯†ç æ ¼å¼ä¸æ­£ç¡® |
| 409 | ç”¨æˆ·åå·²è¢«æ³¨å†Œ |
| 409 | é‚®ç®±å·²è¢«æ³¨å†Œ |

---

### POST /api/users/login
ç”¨æˆ·ç™»å½•ï¼Œè¿”å› JWT Tokenã€‚

**è¯·æ±‚ä½“ï¼š**
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| email | string | äºŒé€‰ä¸€ | é‚®ç®±ç™»å½• |
| username | string | äºŒé€‰ä¸€ | ç”¨æˆ·åç™»å½• |
| password | string | âœ… | å¯†ç  |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "email": "zhangsan@example.com",
    "password": "123456"
}
```

**æˆåŠŸå“åº” (200)ï¼š**
```json
{
    "message": "ç™»å½•æˆåŠŸ",
    "data": {
        "token": "eyJ0eXAiOiJKV1QiLCJhbGci...",
        "user": {
            "id": 1,
            "username": "zhangsan",
            "email": "zhangsan@example.com"
        }
    }
}
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 400 | å¯†ç ä¸æ­£ç¡® / ç¼ºå°‘å¿…å¡«å­—æ®µ |
| 404 | ç”¨æˆ·ä¸å­˜åœ¨ |

---

### GET /api/users/all
è·å–æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ã€‚

**æˆåŠŸå“åº” (200)ï¼š**
```json
{
    "message": "è·å–ç”¨æˆ·æˆåŠŸ",
    "data": {
        "count": 3,
        "users": [
            {
                "id": 1,
                "username": "zhangsan",
                "email": "zhangsan@example.com",
                "created_at": "2026-02-09T10:00:00",
                "updated_at": "2026-02-09T10:00:00"
            }
        ]
    }
}
```

---

## ğŸ“ æ–‡ç« æ¨¡å—

### POST /api/posts ğŸ”’
åˆ›å»ºæ–‡ç« ï¼ˆéœ€è¦ç™»å½•ï¼‰ã€‚

**è¯·æ±‚å¤´ï¼š** `Authorization: Bearer <token>`

**è¯·æ±‚ä½“ï¼š**
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| title | string | âœ… | æ–‡ç« æ ‡é¢˜ï¼ˆ1~200å­—ç¬¦ï¼‰ |
| content | string | âœ… | æ–‡ç« å†…å®¹ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ",
    "content": "è¿™æ˜¯æ–‡ç« çš„å†…å®¹..."
}
```

**æˆåŠŸå“åº” (201)ï¼š**
```json
{
    "message": "åˆ›å»ºæ–‡ç« æˆåŠŸ",
    "data": {
        "post": {
            "id": 1,
            "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ",
            "content": "è¿™æ˜¯æ–‡ç« çš„å†…å®¹...",
            "author_id": 1,
            "created_at": "2026-02-09T10:00:00",
            "updated_at": "2026-02-09T10:00:00"
        }
    }
}
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 400 | æ ‡é¢˜/å†…å®¹æ ¼å¼ä¸æ­£ç¡® |
| 401 | æœªç™»å½• |

---

### GET /api/posts
è·å–æ–‡ç« åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µ + è¿‡æ»¤ + æ’åºï¼‰ã€‚

**æŸ¥è¯¢å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| page | int | 1 | é¡µç  |
| per_page | int | 10 | æ¯é¡µæ•°é‡ï¼ˆæœ€å¤§ 100ï¼‰ |
| keyword | string | æ—  | æœç´¢å…³é”®å­—ï¼ˆæœç´¢æ ‡é¢˜å’Œå†…å®¹ï¼‰ |
| author_id | int | æ—  | æŒ‰ä½œè€…IDè¿‡æ»¤ |
| sort | string | created_at | æ’åºå­—æ®µï¼š`created_at` / `updated_at` / `title` |
| order | string | desc | æ’åºæ–¹å‘ï¼š`desc`ï¼ˆé™åºï¼‰/ `asc`ï¼ˆå‡åºï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/posts?page=1&per_page=5
GET /api/posts?keyword=Flask&sort=title&order=asc
GET /api/posts?author_id=1&page=2
```

**æˆåŠŸå“åº” (200)ï¼š**
```json
{
    "message": "è·å–æ–‡ç« æˆåŠŸ",
    "data": {
        "posts": [
            {
                "id": 1,
                "title": "Flask å…¥é—¨æ•™ç¨‹",
                "content": "æ–‡ç« å†…å®¹...",
                "author_id": 1,
                "created_at": "2026-02-09T10:00:00",
                "updated_at": "2026-02-09T10:00:00"
            }
        ],
        "pagination": {
            "total": 15,
            "page": 1,
            "per_page": 5,
            "total_pages": 3,
            "has_next": true,
            "has_prev": false
        },
        "filters": {
            "keyword": null,
            "author_id": null,
            "sort": "created_at",
            "order": "desc"
        }
    }
}
```

---

### GET /api/posts/:post_id
è·å–æ–‡ç« è¯¦æƒ…ï¼ˆåŒ…å«ä½œè€…ä¿¡æ¯å’Œè¯„è®ºï¼‰ã€‚

**æˆåŠŸå“åº” (200)ï¼š**
```json
{
    "message": "è·å–æ–‡ç« æˆåŠŸ",
    "data": {
        "id": 1,
        "title": "æ–‡ç« æ ‡é¢˜",
        "content": "æ–‡ç« å†…å®¹...",
        "author_id": 1,
        "created_at": "2026-02-09T10:00:00",
        "updated_at": "2026-02-09T10:00:00",
        "author": {
            "id": 1,
            "username": "zhangsan",
            "email": "zhangsan@example.com"
        },
        "comments": [ ... ],
        "comments_count": 3
    }
}
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 404 | æ–‡ç« ä¸å­˜åœ¨ |

---

### PUT /api/posts/:post_id ğŸ”’
æ›´æ–°æ–‡ç« ï¼ˆéœ€è¦ç™»å½•ï¼Œåªèƒ½æ›´æ–°è‡ªå·±çš„æ–‡ç« ï¼‰ã€‚

**è¯·æ±‚å¤´ï¼š** `Authorization: Bearer <token>`

**è¯·æ±‚ä½“ï¼š**
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| title | string | âœ… | æ–°æ ‡é¢˜ï¼ˆ1~200å­—ç¬¦ï¼‰ |
| content | string | âœ… | æ–°å†…å®¹ |

**æˆåŠŸå“åº” (200)ï¼š**
```json
{
    "message": "æ›´æ–°æ–‡ç« æˆåŠŸ",
    "data": {
        "post": {
            "id": 1,
            "title": "æ›´æ–°åçš„æ ‡é¢˜",
            "content": "æ›´æ–°åçš„å†…å®¹...",
            "author_id": 1,
            "created_at": "2026-02-09T10:00:00",
            "updated_at": "2026-02-15T14:00:00"
        }
    }
}
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 400 | æ ‡é¢˜/å†…å®¹æ ¼å¼ä¸æ­£ç¡® |
| 401 | æœªç™»å½• |
| 403 | æ— æƒä¿®æ”¹æ­¤æ–‡ç«  |
| 404 | æ–‡ç« ä¸å­˜åœ¨ |

---

### DELETE /api/posts/:post_id ğŸ”’
åˆ é™¤æ–‡ç« ï¼ˆéœ€è¦ç™»å½•ï¼Œåªèƒ½åˆ é™¤è‡ªå·±çš„æ–‡ç« ï¼‰ã€‚

**è¯·æ±‚å¤´ï¼š** `Authorization: Bearer <token>`

**æˆåŠŸå“åº” (200)ï¼š**
```json
{
    "message": "åˆ é™¤æ–‡ç« æˆåŠŸ"
}
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 401 | æœªç™»å½• |
| 403 | æ— æƒåˆ é™¤æ­¤æ–‡ç«  |
| 404 | æ–‡ç« ä¸å­˜åœ¨ |

---

## ğŸ’¬ è¯„è®ºæ¨¡å—

### POST /api/posts/:post_id/comments ğŸ”’
åˆ›å»ºè¯„è®ºï¼ˆéœ€è¦ç™»å½•ï¼‰ã€‚

**è¯·æ±‚å¤´ï¼š** `Authorization: Bearer <token>`

**è¯·æ±‚ä½“ï¼š**
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| content | string | âœ… | è¯„è®ºå†…å®¹ï¼ˆ1~1000å­—ç¬¦ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "content": "å†™å¾—çœŸå¥½ï¼"
}
```

**æˆåŠŸå“åº” (201)ï¼š**
```json
{
    "message": "åˆ›å»ºè¯„è®ºæˆåŠŸ",
    "data": {
        "comment": {
            "id": 1,
            "content": "å†™å¾—çœŸå¥½ï¼",
            "post_id": 1,
            "author_id": 2,
            "created_at": "2026-02-09T10:30:00",
            "updated_at": "2026-02-09T10:30:00",
            "author": {
                "id": 2,
                "username": "lisi"
            }
        }
    }
}
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 400 | è¯„è®ºå†…å®¹æ ¼å¼ä¸æ­£ç¡® |
| 401 | æœªç™»å½• |
| 404 | æ–‡ç« ä¸å­˜åœ¨ |

---

### GET /api/posts/:post_id/comments
è·å–æ–‡ç« çš„æ‰€æœ‰è¯„è®ºã€‚

**æˆåŠŸå“åº” (200)ï¼š**
```json
{
    "message": "è·å–è¯„è®ºæˆåŠŸ",
    "data": {
        "comments": [
            {
                "id": 1,
                "content": "å†™å¾—çœŸå¥½ï¼",
                "post_id": 1,
                "author_id": 2,
                "created_at": "2026-02-09T10:30:00",
                "updated_at": "2026-02-09T10:30:00",
                "author": {
                    "id": 2,
                    "username": "lisi"
                }
            }
        ],
        "count": 1,
        "post_id": 1
    }
}
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 404 | æ–‡ç« ä¸å­˜åœ¨ |

---

### PUT /api/posts/comments/:comment_id ğŸ”’
æ›´æ–°è¯„è®ºï¼ˆéœ€è¦ç™»å½•ï¼Œåªèƒ½æ›´æ–°è‡ªå·±çš„è¯„è®ºï¼‰ã€‚

**è¯·æ±‚å¤´ï¼š** `Authorization: Bearer <token>`

**è¯·æ±‚ä½“ï¼š**
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| content | string | âœ… | æ–°è¯„è®ºå†…å®¹ï¼ˆ1~1000å­—ç¬¦ï¼‰ |

**æˆåŠŸå“åº” (200)ï¼š**
```json
{
    "message": "æ›´æ–°è¯„è®ºæˆåŠŸ",
    "data": {
        "comment": {
            "id": 1,
            "content": "æ›´æ–°åçš„è¯„è®º",
            "post_id": 1,
            "author_id": 2,
            "created_at": "2026-02-09T10:30:00",
            "updated_at": "2026-02-15T14:00:00",
            "author": {
                "id": 2,
                "username": "lisi"
            }
        }
    }
}
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 400 | è¯„è®ºå†…å®¹æ ¼å¼ä¸æ­£ç¡® |
| 401 | æœªç™»å½• |
| 403 | æ— æƒä¿®æ”¹æ­¤è¯„è®º |
| 404 | è¯„è®ºä¸å­˜åœ¨ |

---

### DELETE /api/posts/comments/:comment_id ğŸ”’
åˆ é™¤è¯„è®ºï¼ˆéœ€è¦ç™»å½•ï¼Œåªèƒ½åˆ é™¤è‡ªå·±çš„è¯„è®ºï¼‰ã€‚

**è¯·æ±‚å¤´ï¼š** `Authorization: Bearer <token>`

**æˆåŠŸå“åº” (200)ï¼š**
```json
{
    "message": "åˆ é™¤è¯„è®ºæˆåŠŸ"
}
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 401 | æœªç™»å½• |
| 403 | æ— æƒåˆ é™¤æ­¤è¯„è®º |
| 404 | è¯„è®ºä¸å­˜åœ¨ |

---

## ğŸ”‘ æ¥å£æƒé™æ€»ç»“

| æ¥å£ | æ–¹æ³• | éœ€è¦ç™»å½• | æƒé™æ§åˆ¶ |
|------|------|----------|----------|
| /api/health | GET | âŒ | æ—  |
| /api/users/register | POST | âŒ | æ—  |
| /api/users/login | POST | âŒ | æ—  |
| /api/users/all | GET | âŒ | æ—  |
| /api/posts | GET | âŒ | æ—  |
| /api/posts/:id | GET | âŒ | æ—  |
| /api/posts | POST | âœ… | æ—  |
| /api/posts/:id | PUT | âœ… | åªèƒ½æ”¹è‡ªå·±çš„ |
| /api/posts/:id | DELETE | âœ… | åªèƒ½åˆ è‡ªå·±çš„ |
| /api/posts/:id/comments | GET | âŒ | æ—  |
| /api/posts/:id/comments | POST | âœ… | æ—  |
| /api/posts/comments/:id | PUT | âœ… | åªèƒ½æ”¹è‡ªå·±çš„ |
| /api/posts/comments/:id | DELETE | âœ… | åªèƒ½åˆ è‡ªå·±çš„ |

> ğŸ”’ = éœ€è¦åœ¨è¯·æ±‚å¤´æºå¸¦ `Authorization: Bearer <token>`

---

## ğŸ“‹ æ—¥å¿—ç³»ç»Ÿ

é¡¹ç›®è¿è¡Œåä¼šè‡ªåŠ¨åœ¨ `logs/` ç›®å½•ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ï¼š

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `logs/app.log` | è®°å½•æ‰€æœ‰ INFO çº§åˆ«ä»¥ä¸Šçš„æ—¥å¿—ï¼ˆè¯·æ±‚ã€æ“ä½œã€è­¦å‘Šç­‰ï¼‰ |
| `logs/error.log` | åªè®°å½• ERROR çº§åˆ«ä»¥ä¸Šçš„æ—¥å¿—ï¼ˆé”™è¯¯ã€å¼‚å¸¸ï¼‰ |

æ—¥å¿—å†…å®¹åŒ…æ‹¬ï¼š
- æ¯æ¬¡ API è¯·æ±‚çš„æ–¹æ³•ã€è·¯å¾„ã€çŠ¶æ€ç ã€è€—æ—¶
- ç”¨æˆ·æ³¨å†Œã€ç™»å½•äº‹ä»¶
- æ–‡ç« /è¯„è®ºçš„åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ“ä½œ
- å¼‚å¸¸é”™è¯¯çš„è¯¦ç»†ä¿¡æ¯

æ—¥å¿—æ–‡ä»¶é…ç½®ï¼š
- å•ä¸ªæ–‡ä»¶æœ€å¤§ **10MB**
- è‡ªåŠ¨è½®è½¬ï¼Œä¿ç•™ **5** ä¸ªå¤‡ä»½æ–‡ä»¶
