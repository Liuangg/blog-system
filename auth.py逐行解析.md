# auth.py é€è¡Œè§£æ â€”â€” JWT è®¤è¯æ¨¡å—

> è¿™ä¸ªæ–‡ä»¶å®ç°äº†åšå®¢ç³»ç»Ÿçš„**ç™»å½•è®¤è¯åŠŸèƒ½**ï¼Œæ ¸å¿ƒæ€è·¯æ˜¯ï¼š
> ç”¨æˆ·ç™»å½•åå‘ä¸€å¼ "é€šè¡Œè¯"ï¼ˆTokenï¼‰ï¼Œä¹‹åæ¯æ¬¡è¯·æ±‚å¸¦ä¸Šè¿™å¼ é€šè¡Œè¯ï¼ŒæœåŠ¡å™¨éªŒè¯é€šè¿‡å°±æ”¾è¡Œã€‚

---

## ğŸ“¦ ç¬¬ä¸€éƒ¨åˆ†ï¼šå¯¼å…¥æ¨¡å—ï¼ˆç¬¬ 1~8 è¡Œï¼‰

```python
"""
è®¤è¯å·¥å…·æ¨¡å—
"""
import jwt                                          # â‘  PyJWT åº“ï¼Œç”¨æ¥ç”Ÿæˆå’Œè§£æ JWT Token
from functools import wraps                         # â‘¡ wrapsï¼šå†™è£…é¥°å™¨æ—¶ä¿ç•™åŸå‡½æ•°çš„åå­—
from datetime import datetime, timedelta            # â‘¢ datetime è·å–å½“å‰æ—¶é—´ï¼Œtimedelta è¡¨ç¤ºæ—¶é—´å·®
from flask import request, jsonify, current_app     # â‘£ Flask çš„è¯·æ±‚ã€å“åº”ã€åº”ç”¨å¯¹è±¡
from models import User                             # â‘¤ ç”¨æˆ·æ¨¡å‹ï¼Œç”¨æ¥æŸ¥æ•°æ®åº“
```

### ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›ï¼Ÿ

| å¯¼å…¥ | ç”¨é€” | å¦‚æœä¸å¯¼å…¥ä¼šæ€æ ·ï¼Ÿ |
|------|------|-------------------|
| `jwt` | ç”Ÿæˆ/éªŒè¯ Token | æ²¡æ³•åšè®¤è¯ |
| `wraps` | è£…é¥°å™¨ä¿æŒå‡½æ•°å | Flask è·¯ç”±ä¼šæŠ¥"é‡å¤å‡½æ•°å"é”™è¯¯ |
| `datetime, timedelta` | è®¾ç½® Token è¿‡æœŸæ—¶é—´ | Token æ²¡æœ‰è¿‡æœŸæ—¶é—´ï¼Œæ°¸ä¹…æœ‰æ•ˆï¼ˆä¸å®‰å…¨ï¼‰ |
| `request` | è·å–è¯·æ±‚å¤´é‡Œçš„ Token | æ‹¿ä¸åˆ°ç”¨æˆ·ä¼ æ¥çš„ Token |
| `jsonify` | è¿”å› JSON æ ¼å¼çš„é”™è¯¯ä¿¡æ¯ | æ— æ³•è¿”å›è§„èŒƒçš„é”™è¯¯å“åº” |
| `current_app` | è·å– SECRET_KEY é…ç½® | æ²¡æœ‰å¯†é’¥å°±æ— æ³•åŠ å¯†/è§£å¯† Token |
| `User` | æŸ¥æ•°æ®åº“æ‰¾ç”¨æˆ· | çŸ¥é“ user_id ä½†æŸ¥ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ |

---

## ğŸ”‘ ç¬¬äºŒéƒ¨åˆ†ï¼šç”Ÿæˆ Token â€”â€” `generate_token()`ï¼ˆç¬¬ 11~31 è¡Œï¼‰

> **ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼Ÿ** ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œè°ƒç”¨æ­¤å‡½æ•°ç”Ÿæˆ Token è¿”å›ç»™ç”¨æˆ·ã€‚

```python
def generate_token(user_id):
```
- å®šä¹‰å‡½æ•°ï¼Œæ¥æ”¶ `user_id`ï¼ˆç”¨æˆ·ç™»å½•æˆåŠŸåä¼ å…¥ï¼Œæ¯”å¦‚ `user_id=1`ï¼‰

```python
    payload = {
        'user_id': user_id,                                    # å­˜å‚¨ç”¨æˆ·ID
        'exp': datetime.utcnow() + timedelta(days=7),         # è¿‡æœŸæ—¶é—´ = ç°åœ¨ + 7å¤©
        'iat': datetime.utcnow()                               # ç­¾å‘æ—¶é—´ = ç°åœ¨
    }
```
- `payload`ï¼ˆè½½è·ï¼‰= Token é‡Œé¢å­˜å‚¨çš„æ•°æ®ï¼Œå°±åƒä¿¡å°é‡Œçš„ä¿¡çº¸å†…å®¹
- `user_id`ï¼šè®°å½•"è¿™ä¸ª Token æ˜¯è°çš„"
- `exp`ï¼ˆexpirationï¼‰ï¼šè¿‡æœŸæ—¶é—´ã€‚`datetime.utcnow()` æ˜¯å½“å‰ UTC æ—¶é—´ï¼Œ`timedelta(days=7)` è¡¨ç¤º 7 å¤©å
- `iat`ï¼ˆissued atï¼‰ï¼šç­¾å‘æ—¶é—´ï¼Œè®°å½• Token ä»€ä¹ˆæ—¶å€™ç”Ÿæˆçš„

```python
    token = jwt.encode(
        payload,                              # ç¬¬1ä¸ªå‚æ•°ï¼šè¦åŠ å¯†çš„æ•°æ®
        current_app.config['SECRET_KEY'],      # ç¬¬2ä¸ªå‚æ•°ï¼šå¯†é’¥ï¼ˆåªæœ‰æœåŠ¡å™¨çŸ¥é“ï¼‰
        algorithm='HS256'                      # ç¬¬3ä¸ªå‚æ•°ï¼šåŠ å¯†ç®—æ³•
    )
    return token
```
- `jwt.encode()`ï¼šæŠŠè½½è·æ•°æ® + å¯†é’¥ â†’ åŠ å¯†ç”Ÿæˆä¸€ä¸ª Token å­—ç¬¦ä¸²
- `SECRET_KEY`ï¼šæœåŠ¡å™¨çš„ç§æœ‰å¯†é’¥ï¼Œç”¨æ¥ç­¾åã€‚åˆ«äººä¸çŸ¥é“è¿™ä¸ªå¯†é’¥å°±ä¼ªé€ ä¸äº† Token
- `HS256`ï¼šä¸€ç§å¸¸ç”¨çš„ç­¾åç®—æ³•ï¼ˆHMAC + SHA256ï¼‰
- æœ€ç»ˆè¿”å›çš„ Token é•¿è¿™æ ·ï¼š`eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo...`

### ğŸ§  ç±»æ¯”ç†è§£

> Token å°±åƒ**ç”µå½±ç¥¨**ï¼š
> - `user_id` = åº§ä½å·ï¼ˆè°çš„ç¥¨ï¼‰
> - `exp` = åœºæ¬¡ç»“æŸæ—¶é—´ï¼ˆè¿‡æœŸä½œåºŸï¼‰
> - `iat` = è´­ç¥¨æ—¶é—´
> - `SECRET_KEY` = é˜²ä¼ªæ°´å°ï¼ˆåªæœ‰å½±é™¢èƒ½ç›–ï¼‰
> - `jwt.encode()` = æ‰“å°è¿™å¼ ç¥¨

---

## âœ… ç¬¬ä¸‰éƒ¨åˆ†ï¼šéªŒè¯ Token â€”â€” `verify_token()`ï¼ˆç¬¬ 34~54 è¡Œï¼‰

> **ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼Ÿ** ç”¨æˆ·å‘æ¥è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä»è¯·æ±‚å¤´æ‹¿åˆ° Token åè°ƒç”¨æ­¤å‡½æ•°éªŒè¯ã€‚

```python
def verify_token(token):
```
- æ¥æ”¶ä¸€ä¸ª Token å­—ç¬¦ä¸²

```python
    try:
        payload = jwt.decode(
            token,                                # ç¬¬1ä¸ªå‚æ•°ï¼šè¦è§£å¯†çš„ Token
            current_app.config['SECRET_KEY'],      # ç¬¬2ä¸ªå‚æ•°ï¼šå¯†é’¥ï¼ˆå¿…é¡»å’ŒåŠ å¯†æ—¶ä¸€æ ·ï¼‰
            algorithms=['HS256']                   # ç¬¬3ä¸ªå‚æ•°ï¼šç®—æ³•ï¼ˆå¿…é¡»å’ŒåŠ å¯†æ—¶ä¸€æ ·ï¼‰
        )
        return payload
```
- `jwt.decode()`ï¼šåå‘æ“ä½œï¼ŒæŠŠ Token å­—ç¬¦ä¸² â†’ è§£å¯†è¿˜åŸæˆè½½è·å­—å…¸
- å¦‚æœè§£å¯†æˆåŠŸï¼Œè¿”å› `{'user_id': 1, 'exp': ..., 'iat': ...}`
- **è‡ªåŠ¨æ£€æŸ¥ exp**ï¼šPyJWT ä¼šè‡ªåŠ¨åˆ¤æ–­ Token æ˜¯å¦è¿‡æœŸ

```python
    except jwt.ExpiredSignatureError:
        return None   # Token å·²è¿‡æœŸï¼ˆè¶…è¿‡7å¤©äº†ï¼‰
    except jwt.InvalidTokenError:
        return None   # Token æ— æ•ˆï¼ˆè¢«ç¯¡æ”¹/æ ¼å¼é”™è¯¯ï¼‰
```
- ä¸¤ç§å¤±è´¥æƒ…å†µéƒ½è¿”å› `None`ï¼Œè¡¨ç¤ºéªŒè¯ä¸é€šè¿‡

### ğŸ§  ç±»æ¯”ç†è§£

> å°±åƒ**æ£€ç¥¨å‘˜**æ£€æŸ¥ä½ çš„ç”µå½±ç¥¨ï¼š
> - çœ‹é˜²ä¼ªæ°´å°ï¼ˆå¯†é’¥éªŒè¯ï¼‰â†’ å‡ç¥¨ï¼ŸâŒ `InvalidTokenError`
> - çœ‹åœºæ¬¡æ—¶é—´ï¼ˆexp éªŒè¯ï¼‰â†’ è¿‡æœŸäº†ï¼ŸâŒ `ExpiredSignatureError`
> - éƒ½æ²¡é—®é¢˜ â†’ âœ… æ”¾è¡Œ

---

## ğŸ‘¤ ç¬¬å››éƒ¨åˆ†ï¼šè·å–å½“å‰ç”¨æˆ· â€”â€” `get_current_user()`ï¼ˆç¬¬ 57~86 è¡Œï¼‰

> **ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼Ÿ** åœ¨éœ€è¦çŸ¥é“"å½“å‰æ˜¯è°åœ¨æ“ä½œ"çš„æ¥å£ä¸­è°ƒç”¨ã€‚
> è¿™ä¸ªå‡½æ•°æŠŠå‰é¢çš„åŠŸèƒ½ä¸²èµ·æ¥äº†ï¼Œæ˜¯ä¸€ä¸ª**å®Œæ•´çš„è®¤è¯æµæ°´çº¿**ã€‚

### ç¬¬ 1 æ­¥ï¼šä»è¯·æ±‚å¤´å– Token

```python
    auth_header = request.headers.get('Authorization')
    if not auth_header:
        return None
```
- `request.headers` = è¯·æ±‚å¤´ï¼ˆHTTP è¯·æ±‚é™„å¸¦çš„å…ƒä¿¡æ¯ï¼‰
- `.get('Authorization')` = å– `Authorization` å­—æ®µçš„å€¼
- ç”¨æˆ·ä¼ æ¥çš„æ ¼å¼æ˜¯ï¼š`Authorization: Bearer eyJ0eXA...`
- å¦‚æœæ²¡ä¼ è¿™ä¸ªè¯·æ±‚å¤´ â†’ æ²¡å¸¦é€šè¡Œè¯ â†’ è¿”å› None

### ç¬¬ 2 æ­¥ï¼šæå–çº¯ Token

```python
    try:
        token = auth_header.split(' ')[1] if ' ' in auth_header else auth_header
    except IndexError:
        return None
```
- è¯·æ±‚å¤´å€¼å¯èƒ½æ˜¯ `"Bearer eyJ0eXA..."` æˆ–ç›´æ¥ `"eyJ0eXA..."`
- `split(' ')` æŒ‰ç©ºæ ¼åˆ†å‰²ï¼š`["Bearer", "eyJ0eXA..."]`
- `[1]` å–ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆçº¯ Token éƒ¨åˆ†ï¼‰
- å¦‚æœæ²¡æœ‰ç©ºæ ¼ï¼Œç›´æ¥æŠŠæ•´ä¸ªå€¼å½“ä½œ Token ä½¿ç”¨

### ç¬¬ 3 æ­¥ï¼šéªŒè¯ Token

```python
    payload = verify_token(token)
    if not payload:
        return None
```
- è°ƒç”¨ä¸Šé¢çš„ `verify_token()` å‡½æ•°è§£å¯†éªŒè¯
- éªŒè¯å¤±è´¥ï¼ˆè¿‡æœŸ/æ— æ•ˆï¼‰â†’ è¿”å› None

### ç¬¬ 4 æ­¥ï¼šæŸ¥æ•°æ®åº“æ‰¾ç”¨æˆ·

```python
    user_id = payload.get('user_id')
    if not user_id:
        return None
    
    user = User.query.get(user_id)
    return user
```
- ä»è§£å¯†åçš„è½½è·ä¸­å–å‡º `user_id`
- `User.query.get(user_id)` = ç”¨ä¸»é”®æŸ¥æ•°æ®åº“
- è¿”å›ç”¨æˆ·å¯¹è±¡ï¼ˆæ‰¾ä¸åˆ°å°±è¿”å› Noneï¼‰

### ğŸ§  å®Œæ•´æµç¨‹

```
è¯·æ±‚å¤´ Authorization: "Bearer eyJ0eXA..."
    â†“
ç¬¬1æ­¥ï¼šå–å‡º "Bearer eyJ0eXA..."
    â†“
ç¬¬2æ­¥ï¼šåˆ†å‰²å¾—åˆ° "eyJ0eXA..."ï¼ˆçº¯Tokenï¼‰
    â†“
ç¬¬3æ­¥ï¼šverify_token() è§£å¯† â†’ {'user_id': 1, 'exp': ...}
    â†“
ç¬¬4æ­¥ï¼šUser.query.get(1) â†’ ä»æ•°æ®åº“å–å‡ºç”¨æˆ·å¯¹è±¡
    â†“
è¿”å›ï¼š<User ç‹éº»å­>
```

---

## ğŸ›¡ï¸ ç¬¬äº”éƒ¨åˆ†ï¼šç™»å½•éªŒè¯è£…é¥°å™¨ â€”â€” `login_required()`ï¼ˆç¬¬ 89~117 è¡Œï¼‰

> **è¿™æ˜¯æ•´ä¸ªæ–‡ä»¶æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼** åŠ ä¸Š `@login_required` å°±èƒ½è®©ä»»ä½•æ¥å£å˜æˆ"éœ€è¦ç™»å½•"ã€‚

### ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ

è£…é¥°å™¨å°±æ˜¯ä¸€ä¸ª**åŒ…è£…å‡½æ•°**ï¼Œåœ¨åŸå‡½æ•°æ‰§è¡Œ**ä¹‹å‰**æ’å…¥é¢å¤–çš„é€»è¾‘ã€‚

```
æ²¡æœ‰è£…é¥°å™¨ï¼š    ç”¨æˆ·è¯·æ±‚ â†’ ç›´æ¥æ‰§è¡Œ create_post()
æœ‰è£…é¥°å™¨ï¼š      ç”¨æˆ·è¯·æ±‚ â†’ å…ˆæ£€æŸ¥ç™»å½• â†’ é€šè¿‡æ‰æ‰§è¡Œ create_post()
```

### é€è¡Œè§£æ

```python
def login_required(f):
```
- `f` = è¢«è£…é¥°çš„åŸå‡½æ•°ï¼ˆæ¯”å¦‚ `create_post`ã€`update_post`ï¼‰

```python
    @wraps(f)
    def decorated_function(*args, **kwargs):
```
- `@wraps(f)`ï¼šè®©åŒ…è£…å‡½æ•°ä¿ç•™åŸå‡½æ•°çš„åå­—å’Œæ–‡æ¡£
  - ä¸åŠ  wraps â†’ æ‰€æœ‰å‡½æ•°éƒ½å« `decorated_function` â†’ Flask æŠ¥é”™"è·¯ç”±åå†²çª"
  - åŠ äº† wraps â†’ å‡½æ•°åä¿æŒä¸º `create_post`ã€`update_post` ç­‰
- `*args, **kwargs`ï¼šæ¥å—ä»»æ„å‚æ•°ï¼Œè¿™æ ·ä¸ç®¡åŸå‡½æ•°æœ‰å‡ ä¸ªå‚æ•°éƒ½èƒ½æ­£å¸¸å·¥ä½œ
  - æ¯”å¦‚ `update_post(post_id)` æœ‰ä¸€ä¸ªå‚æ•°ï¼Œ`health_check()` æ²¡æœ‰å‚æ•°

```python
        current_user = get_current_user()
        
        if not current_user:
            return jsonify({
                'error': 'éœ€è¦ç™»å½•',
                'message': 'è¯·å…ˆç™»å½•åå†è¿›è¡Œæ“ä½œ'
            }), 401
```
- è°ƒç”¨ `get_current_user()` éªŒè¯èº«ä»½
- å¦‚æœè¿”å› Noneï¼ˆæœªç™»å½•/Token æ— æ•ˆï¼‰â†’ **ç›´æ¥è¿”å› 401 é”™è¯¯ï¼ŒåŸå‡½æ•°ä¸ä¼šæ‰§è¡Œ**
- `401` = HTTP çŠ¶æ€ç "æœªæˆæƒ"ï¼ˆUnauthorizedï¼‰

```python
        request.current_user = current_user
```
- éªŒè¯é€šè¿‡ï¼æŠŠç”¨æˆ·å¯¹è±¡æŒ‚åˆ° `request` ä¸Š
- åç»­å¯ä»¥é€šè¿‡ `request.current_user` è·å–å½“å‰ç”¨æˆ·ï¼ˆå¤‡ç”¨æ–¹å¼ï¼‰

```python
        return f(*args, **kwargs)
```
- **æ‰§è¡ŒåŸå‡½æ•°**ï¼æ¯”å¦‚çœŸæ­£å»åˆ›å»ºæ–‡ç« ã€æ›´æ–°è¯„è®ºç­‰
- `f` å°±æ˜¯åŸå‡½æ•°ï¼Œ`*args, **kwargs` æŠŠå‚æ•°é€ä¼ è¿‡å»

```python
    return decorated_function
```
- è¿”å›åŒ…è£…åçš„å‡½æ•°ï¼Œæ›¿æ¢åŸå‡½æ•°

### ğŸ§  ç±»æ¯”ç†è§£

> `@login_required` å°±åƒ**å°åŒºé—¨å«**ï¼š
> ```
> ä½ è¦è¿›å°åŒºï¼ˆè°ƒç”¨æ¥å£ï¼‰
>     â†“
> é—¨å«æ‹¦ä½ä½ ï¼šè¯·å‡ºç¤ºé—¨ç¦å¡ï¼ˆTokenï¼‰
>     â†“
> â”œâ”€â”€ æ²¡å¸¦å¡ / å¡è¿‡æœŸ â†’ "éœ€è¦ç™»å½•"ï¼ˆ401ï¼‰ï¼Œä¸è®©è¿›
> â””â”€â”€ å¡æœ‰æ•ˆ â†’ æ”¾è¡Œï¼æ‰§è¡ŒåŸå‡½æ•°
> ```

### ä½¿ç”¨æ–¹å¼

```python
# åŠ ä¸Š @login_required å°±è¡Œäº†ï¼Œä¸€è¡Œä»£ç æå®šï¼

@app.route('/api/posts', methods=['POST'])
@login_required                              # â† åŠ äº†è¿™ä¸€è¡Œï¼Œè¿™ä¸ªæ¥å£å°±éœ€è¦ç™»å½•äº†
def create_post():
    current_user = get_current_user()        # è·å–å½“å‰ç™»å½•ç”¨æˆ·
    # ... åˆ›å»ºæ–‡ç« çš„é€»è¾‘ ...
```

---

## ğŸ¯ å››ä¸ªå‡½æ•°çš„å…³ç³»æ€»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å®Œæ•´è®¤è¯æµç¨‹                               â”‚
â”‚                                                              â”‚
â”‚  ã€ç™»å½•æ—¶ã€‘                                                   â”‚
â”‚  ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç  â†’ éªŒè¯é€šè¿‡ â†’ generate_token(user_id)        â”‚
â”‚                                  â†“                           â”‚
â”‚                          è¿”å› Token ç»™ç”¨æˆ·                    â”‚
â”‚                                                              â”‚
â”‚  â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€  â”‚
â”‚                                                              â”‚
â”‚  ã€åç»­è¯·æ±‚æ—¶ã€‘                                               â”‚
â”‚  ç”¨æˆ·è¯·æ±‚ï¼ˆå¸¦ Tokenï¼‰                                         â”‚
â”‚         â†“                                                    â”‚
â”‚  @login_requiredï¼ˆè£…é¥°å™¨æ‹¦æˆªï¼‰                                 â”‚
â”‚         â†“                                                    â”‚
â”‚  get_current_user()                                          â”‚
â”‚    â”œâ”€â”€ ä»è¯·æ±‚å¤´æå– Token                                     â”‚
â”‚    â”œâ”€â”€ verify_token() éªŒè¯ Token                              â”‚
â”‚    â””â”€â”€ User.query.get() æŸ¥æ•°æ®åº“                              â”‚
â”‚         â†“                                                    â”‚
â”‚  â”œâ”€â”€ å¤±è´¥ â†’ è¿”å› 401 "éœ€è¦ç™»å½•"                               â”‚
â”‚  â””â”€â”€ æˆåŠŸ â†’ æ‰§è¡ŒåŸå‡½æ•°ï¼ˆåˆ›å»ºæ–‡ç« /æ›´æ–°è¯„è®ºç­‰ï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µæ€»ç»“

### JWT æ˜¯ä»€ä¹ˆï¼Ÿ

**JWT**ï¼ˆJSON Web Tokenï¼‰= ä¸€ç§å®‰å…¨çš„èº«ä»½è®¤è¯æ–¹å¼

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆSessionï¼‰ï¼šæœåŠ¡å™¨è®°ä½ä½ æ˜¯è°ï¼ˆåƒé…’åº—æˆ¿å¡ï¼Œä¿¡æ¯å­˜åœ¨é…’åº—ç³»ç»Ÿé‡Œï¼‰
JWT æ–¹å¼ï¼ˆTokenï¼‰ï¼š  ä½ è‡ªå·±å¸¦ç€è¯æ˜ï¼ˆåƒæŠ¤ç…§ï¼Œä¿¡æ¯å­˜åœ¨ä½ èº«ä¸Šï¼ŒæœåŠ¡å™¨åªè´Ÿè´£éªŒè¯çœŸä¼ªï¼‰
```

### JWT Token çš„ä¸‰æ®µç»“æ„

```
eyJ0eXAiOiJKV1Q.eyJ1c2VyX2lkIjox.SflKxwRJSMeKKF2QT4
  â†‘ å¤´éƒ¨(Header)    â†‘ è½½è·(Payload)    â†‘ ç­¾å(Signature)
  
å¤´éƒ¨ï¼šè¯´æ˜ç”¨äº†ä»€ä¹ˆç®—æ³•ï¼ˆHS256ï¼‰
è½½è·ï¼šå­˜å‚¨çš„æ•°æ®ï¼ˆuser_idã€è¿‡æœŸæ—¶é—´ç­‰ï¼‰
ç­¾åï¼šç”¨ SECRET_KEY ç”Ÿæˆçš„é˜²ä¼ªç 
```

### ä¸ºä»€ä¹ˆç”¨ JWT è€Œä¸æ˜¯ Sessionï¼Ÿ

| å¯¹æ¯” | Session | JWT |
|------|---------|-----|
| æ•°æ®å­˜å“ªé‡Œ | æœåŠ¡å™¨å†…å­˜ | å®¢æˆ·ç«¯ï¼ˆTokenï¼‰ |
| æœåŠ¡å™¨å‹åŠ› | å¤§ï¼ˆè¦å­˜æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼‰ | å°ï¼ˆåªéœ€éªŒè¯ç­¾åï¼‰ |
| æ‰©å±•æ€§ | å·®ï¼ˆå¤šå°æœåŠ¡å™¨è¦å…±äº« Sessionï¼‰ | å¥½ï¼ˆæ— çŠ¶æ€ï¼Œä»»ä½•æœåŠ¡å™¨éƒ½èƒ½éªŒè¯ï¼‰ |
| é€‚åˆåœºæ™¯ | ä¼ ç»Ÿç½‘é¡µ | API æ¥å£ã€ç§»åŠ¨ç«¯ |
