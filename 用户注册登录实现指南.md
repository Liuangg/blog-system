# ç”¨æˆ·æ³¨å†Œå’Œç™»å½•å®ç°æŒ‡å—

## â“ éœ€è¦è‡ªå·±å†™å—ï¼Ÿ

**ç­”æ¡ˆ**ï¼š**æ˜¯çš„ï¼Œéœ€è¦è‡ªå·±å®ç°ï¼** è¿™æ˜¯ Day 22-24 çš„æ ¸å¿ƒä»»åŠ¡ã€‚

## ğŸ“… å­¦ä¹ è®¡åˆ’

- **Day 20-21**ï¼šé¡¹ç›®è§„åˆ’ + æ•°æ®åº“è®¾è®¡ âœ…ï¼ˆå·²å®Œæˆï¼‰
- **Day 22-24**ï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ˆåŒ…æ‹¬ç”¨æˆ·æ³¨å†Œå’Œç™»å½•ï¼‰â† **ä½ ç°åœ¨è¦åšçš„**

## ğŸ¯ å®ç°æ–¹å¼

### æ–¹å¼1ï¼šå‚è€ƒ Day 19 çš„ä»£ç ï¼ˆæ¨èï¼‰

Day 19 å·²ç»å®ç°äº†ç”¨æˆ·æ³¨å†Œå’Œç™»å½•ï¼Œä½ å¯ä»¥ï¼š
1. å‚è€ƒ Day 19 çš„ä»£ç 
2. æ ¹æ®åšå®¢ç³»ç»Ÿçš„éœ€æ±‚è°ƒæ•´
3. æ³¨æ„å­—æ®µåçš„å·®å¼‚ï¼ˆDay 19 ç”¨ `name`ï¼Œåšå®¢ç³»ç»Ÿç”¨ `username`ï¼‰

### æ–¹å¼2ï¼šå®Œå…¨è‡ªå·±å†™

å¦‚æœä½ å·²ç»ç†è§£äº† Day 19 çš„é€»è¾‘ï¼Œå¯ä»¥å®Œå…¨è‡ªå·±å†™ã€‚

## ğŸ“ å‚è€ƒä»£ç ï¼ˆDay 19ï¼‰

### ç”¨æˆ·æ³¨å†Œ API

```python
@app.route('/api/users/register', methods=['POST'])
def register():
    """
    ç”¨æˆ·æ³¨å†Œ API
    
    è¯·æ±‚ä½“ï¼ˆJSONï¼‰ï¼š
    {
        "username": "å¼ ä¸‰",
        "email": "zhangsan@example.com",
        "password": "123456"
    }
    """
    try:
        # 1. è·å–è¯·æ±‚æ•°æ®
        data = request.get_json()
        
        # 2. éªŒè¯å¿…å¡«å­—æ®µ
        if not data:
            return jsonify({'error': 'è¯·æ±‚ä½“ä¸èƒ½ä¸ºç©º'}), 400
        
        if not data.get('username'):
            return jsonify({'error': 'ç¼ºå°‘å¿…å¡«å­—æ®µ: username'}), 400
        
        if not data.get('email'):
            return jsonify({'error': 'ç¼ºå°‘å¿…å¡«å­—æ®µ: email'}), 400
        
        if not data.get('password'):
            return jsonify({'error': 'ç¼ºå°‘å¿…å¡«å­—æ®µ: password'}), 400
        
        # 3. éªŒè¯é‚®ç®±æ ¼å¼ï¼ˆç®€å•éªŒè¯ï¼‰
        if '@' not in data['email']:
            return jsonify({'error': 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'}), 400
        
        # 4. æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
        existing_user = User.query.filter_by(email=data['email']).first()
        if existing_user:
            return jsonify({'error': 'é‚®ç®±å·²è¢«æ³¨å†Œ'}), 400
        
        # 5. æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
        existing_username = User.query.filter_by(username=data['username']).first()
        if existing_username:
            return jsonify({'error': 'ç”¨æˆ·åå·²è¢«ä½¿ç”¨'}), 400
        
        # 6. åˆ›å»ºæ–°ç”¨æˆ·
        new_user = User(
            username=data['username'],
            email=data['email'],
            password=data['password']  # å®é™…åº”ç”¨ä¸­åº”è¯¥ä½¿ç”¨åŠ å¯†
        )
        
        db.session.add(new_user)
        db.session.commit()
        
        # 7. è¿”å›æˆåŠŸå“åº”
        return jsonify({
            'message': 'æ³¨å†ŒæˆåŠŸ',
            'user': new_user.to_dict()
        }), 201
        
    except Exception as e:
        db.session.rollback()
        return jsonify({'error': f'æ³¨å†Œå¤±è´¥: {str(e)}'}), 500
```

### ç”¨æˆ·ç™»å½• API

```python
@app.route('/api/users/login', methods=['POST'])
def login():
    """
    ç”¨æˆ·ç™»å½• API
    
    è¯·æ±‚ä½“ï¼ˆJSONï¼‰ï¼š
    {
        "email": "zhangsan@example.com",
        "password": "123456"
    }
    """
    try:
        # 1. è·å–è¯·æ±‚æ•°æ®
        data = request.get_json()
        
        # 2. éªŒè¯å¿…å¡«å­—æ®µ
        if not data:
            return jsonify({'error': 'è¯·æ±‚ä½“ä¸èƒ½ä¸ºç©º'}), 400
        
        if not data.get('email'):
            return jsonify({'error': 'ç¼ºå°‘é‚®ç®±'}), 400
        
        if not data.get('password'):
            return jsonify({'error': 'ç¼ºå°‘å¯†ç '}), 400
        
        # 3. æŸ¥æ‰¾ç”¨æˆ·
        user = User.query.filter_by(email=data['email']).first()
        
        # 4. éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        if not user:
            return jsonify({'error': 'ç”¨æˆ·ä¸å­˜åœ¨'}), 404
        
        # 5. éªŒè¯å¯†ç 
        if user.password != data['password']:  # å®é™…åº”ç”¨ä¸­åº”è¯¥ä½¿ç”¨åŠ å¯†æ¯”è¾ƒ
            return jsonify({'error': 'å¯†ç é”™è¯¯'}), 401
        
        # 6. ç™»å½•æˆåŠŸ
        return jsonify({
            'message': 'ç™»å½•æˆåŠŸ',
            'user': user.to_dict()
        }), 200
        
    except Exception as e:
        return jsonify({'error': f'ç™»å½•å¤±è´¥: {str(e)}'}), 500
```

## ğŸ”„ Day 19 vs åšå®¢ç³»ç»Ÿçš„å·®å¼‚

### å­—æ®µåå·®å¼‚

| Day 19 | åšå®¢ç³»ç»Ÿ | è¯´æ˜ |
|--------|---------|------|
| `name` | `username` | å­—æ®µåä¸åŒ |
| `name` | `username` | æŸ¥è¯¢æ—¶è¦ç”¨ `username` |

### éœ€è¦ä¿®æ”¹çš„åœ°æ–¹

1. **æ³¨å†Œ API**ï¼š
   - `data.get('name')` â†’ `data.get('username')`
   - `name=data['name']` â†’ `username=data['username']`
   - æ·»åŠ ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥

2. **ç™»å½• API**ï¼š
   - åŸºæœ¬ä¸éœ€è¦ä¿®æ”¹ï¼ˆéƒ½ç”¨ email ç™»å½•ï¼‰

## ğŸ“‹ å®ç°æ­¥éª¤

### æ­¥éª¤1ï¼šå®ç°ç”¨æˆ·æ³¨å†Œ

1. å¤åˆ¶ Day 19 çš„æ³¨å†Œä»£ç 
2. ä¿®æ”¹å­—æ®µåï¼ˆ`name` â†’ `username`ï¼‰
3. æ·»åŠ ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥
4. ä½¿ç”¨ `new_user.to_dict()` è¿”å›æ•°æ®

### æ­¥éª¤2ï¼šå®ç°ç”¨æˆ·ç™»å½•

1. å¤åˆ¶ Day 19 çš„ç™»å½•ä»£ç 
2. åŸºæœ¬ä¸éœ€è¦ä¿®æ”¹
3. ä½¿ç”¨ `user.to_dict()` è¿”å›æ•°æ®

### æ­¥éª¤3ï¼šæµ‹è¯•

ä½¿ç”¨ Postman æµ‹è¯•ï¼š
- æ³¨å†Œæ–°ç”¨æˆ·
- ç™»å½•ç”¨æˆ·
- éªŒè¯è¿”å›çš„æ•°æ®

## ğŸ’¡ å®Œæ•´å®ç°ç¤ºä¾‹

æˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†å®Œæ•´çš„å®ç°ä»£ç ï¼Œè§ `ç”¨æˆ·æ³¨å†Œç™»å½•_å®Œæ•´å®ç°.py`ï¼ˆæˆ‘ä¼šåˆ›å»ºè¿™ä¸ªæ–‡ä»¶ï¼‰ã€‚

## ğŸ¯ å…³é”®ç‚¹

### 1. æ•°æ®éªŒè¯

```python
# å¿…é¡»éªŒè¯æ‰€æœ‰å¿…å¡«å­—æ®µ
if not data.get('username'):
    return jsonify({'error': 'ç¼ºå°‘å¿…å¡«å­—æ®µ: username'}), 400
```

### 2. å”¯ä¸€æ€§æ£€æŸ¥

```python
# æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
existing_user = User.query.filter_by(email=data['email']).first()
if existing_user:
    return jsonify({'error': 'é‚®ç®±å·²è¢«æ³¨å†Œ'}), 400
```

### 3. é”™è¯¯å¤„ç†

```python
try:
    # æ•°æ®åº“æ“ä½œ
    db.session.add(new_user)
    db.session.commit()
except Exception as e:
    db.session.rollback()  # å›æ»š
    return jsonify({'error': f'æ³¨å†Œå¤±è´¥: {str(e)}'}), 500
```

### 4. ä½¿ç”¨ to_dict()

```python
# è¿”å›ç”¨æˆ·æ•°æ®æ—¶ä½¿ç”¨ to_dict()
return jsonify({
    'message': 'æ³¨å†ŒæˆåŠŸ',
    'user': new_user.to_dict()  # â† ä½¿ç”¨ to_dict()
}), 201
```

## âœ… æ£€æŸ¥æ¸…å•

å®ç°å®Œæˆåï¼Œæ£€æŸ¥ï¼š

- [ ] æ³¨å†Œæ¥å£å¯ä»¥åˆ›å»ºæ–°ç”¨æˆ·
- [ ] æ³¨å†Œæ—¶éªŒè¯å¿…å¡«å­—æ®µ
- [ ] æ³¨å†Œæ—¶æ£€æŸ¥é‚®ç®±å”¯ä¸€æ€§
- [ ] æ³¨å†Œæ—¶æ£€æŸ¥ç”¨æˆ·åå”¯ä¸€æ€§
- [ ] ç™»å½•æ¥å£å¯ä»¥éªŒè¯ç”¨æˆ·
- [ ] ç™»å½•æ—¶éªŒè¯é‚®ç®±å’Œå¯†ç 
- [ ] é”™è¯¯å¤„ç†å®Œå–„ï¼ˆtry-exceptï¼‰
- [ ] ä½¿ç”¨ to_dict() è¿”å›æ•°æ®
- [ ] ä½¿ç”¨ Postman æµ‹è¯•é€šè¿‡

## ğŸš€ å¼€å§‹å®ç°

1. **æ‰“å¼€** `Day20-21_å•æ–‡ä»¶ç‰ˆæœ¬.py`
2. **æ‰¾åˆ°** ç¬¬ 180-187 è¡Œçš„å ä½ä»£ç 
3. **æ›¿æ¢** ä¸ºå®Œæ•´çš„å®ç°ä»£ç 
4. **æµ‹è¯•** ä½¿ç”¨ Postman

---

**è®°ä½**ï¼š
- âœ… å‚è€ƒ Day 19 çš„ä»£ç 
- âœ… æ³¨æ„å­—æ®µåçš„å·®å¼‚
- âœ… æ·»åŠ ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥
- âœ… ä½¿ç”¨ to_dict() è¿”å›æ•°æ®
- âœ… å®Œå–„é”™è¯¯å¤„ç†

**åŠ æ²¹ï¼ä½ å¯ä»¥çš„ï¼** ğŸ’ª
