# Day 22-24 详细任务分解

## 📋 任务总览

**时间**：2月3-5日（3天）  
**预计时间**：每天 6-7 小时  
**总时间**：18-21 小时

---

## Day 22（第一天）：用户注册/登录 API ⭐⭐⭐⭐⭐

### 任务1：实现用户注册 API

**接口**：`POST /api/users/register`

**功能要求**：
- [ ] 接收用户信息（username, email, password）
- [ ] 验证必填字段
- [ ] 验证邮箱格式
- [ ] 检查邮箱是否已存在
- [ ] 检查用户名是否已存在
- [ ] 创建新用户
- [ ] 返回用户信息（不包含密码）

**请求示例**：
```json
{
    "username": "张三",
    "email": "zhangsan@example.com",
    "password": "123456"
}
```

**响应示例**：
```json
{
    "message": "注册成功",
    "user": {
        "id": 1,
        "username": "张三",
        "email": "zhangsan@example.com",
        "created_at": "2024-01-01T10:30:00"
    }
}
```

**参考代码**：
- `Day19_用户管理API_完整案例.py`（第 73-143 行）
- `用户注册登录_完整实现.py`

**预计时间**：2-3 小时

---

### 任务2：实现用户登录 API

**接口**：`POST /api/users/login`

**功能要求**：
- [ ] 接收邮箱和密码
- [ ] 验证必填字段
- [ ] 查找用户（根据邮箱）
- [ ] 验证用户是否存在
- [ ] 验证密码是否正确
- [ ] 返回用户信息（不包含密码）

**请求示例**：
```json
{
    "email": "zhangsan@example.com",
    "password": "123456"
}
```

**响应示例**：
```json
{
    "message": "登录成功",
    "user": {
        "id": 1,
        "username": "张三",
        "email": "zhangsan@example.com"
    }
}
```

**参考代码**：
- `Day19_用户管理API_完整案例.py`（第 147-204 行）
- `用户注册登录_完整实现.py`

**预计时间**：1-2 小时

---

### 任务3：测试用户注册和登录

**测试工具**：Postman

**测试步骤**：
1. 测试用户注册（成功情况）
2. 测试用户注册（邮箱已存在）
3. 测试用户注册（用户名已存在）
4. 测试用户注册（缺少必填字段）
5. 测试用户登录（成功情况）
6. 测试用户登录（用户不存在）
7. 测试用户登录（密码错误）

**预计时间**：1 小时

---

## Day 23（第二天）：文章 CRUD API ⭐⭐⭐⭐⭐

### 任务1：实现创建文章 API

**接口**：`POST /api/posts`

**功能要求**：
- [ ] 接收文章信息（title, content, author_id）
- [ ] 验证必填字段
- [ ] 验证作者是否存在
- [ ] 创建新文章
- [ ] 返回文章信息

**请求示例**：
```json
{
    "title": "我的第一篇文章",
    "content": "这是文章内容...",
    "author_id": 1
}
```

**响应示例**：
```json
{
    "message": "创建成功",
    "post": {
        "id": 1,
        "title": "我的第一篇文章",
        "content": "这是文章内容...",
        "author_id": 1,
        "created_at": "2024-01-01T10:30:00"
    }
}
```

**参考模式**：用户注册 API 的模式

**预计时间**：1-2 小时

---

### 任务2：实现文章列表 API

**接口**：`GET /api/posts`

**功能要求**：
- [ ] 获取所有文章
- [ ] 返回文章列表
- [ ] 包含文章数量

**响应示例**：
```json
{
    "count": 2,
    "posts": [
        {
            "id": 1,
            "title": "我的第一篇文章",
            "content": "这是文章内容...",
            "author_id": 1
        },
        {
            "id": 2,
            "title": "我的第二篇文章",
            "content": "这是第二篇文章...",
            "author_id": 1
        }
    ]
}
```

**参考模式**：用户列表 API 的模式（Day 19 第 254-275 行）

**预计时间**：1 小时

---

### 任务3：实现文章详情 API

**接口**：`GET /api/posts/<id>`

**功能要求**：
- [ ] 根据 ID 获取文章
- [ ] 验证文章是否存在
- [ ] 返回文章详情

**响应示例**：
```json
{
    "id": 1,
    "title": "我的第一篇文章",
    "content": "这是文章内容...",
    "author_id": 1,
    "created_at": "2024-01-01T10:30:00",
    "updated_at": "2024-01-01T10:30:00"
}
```

**参考模式**：用户详情 API 的模式（Day 19 第 277-294 行）

**预计时间**：1 小时

---

### 任务4：实现更新文章 API

**接口**：`PUT /api/posts/<id>`

**功能要求**：
- [ ] 验证文章是否存在
- [ ] 接收更新数据
- [ ] 更新文章字段
- [ ] 返回更新后的文章

**请求示例**：
```json
{
    "title": "更新后的标题",
    "content": "更新后的内容"
}
```

**参考模式**：用户更新 API 的模式（Day 19 第 298-345 行）

**预计时间**：1-2 小时

---

### 任务5：实现删除文章 API

**接口**：`DELETE /api/posts/<id>`

**功能要求**：
- [ ] 验证文章是否存在
- [ ] 删除文章（会自动删除相关评论，因为设置了 cascade）
- [ ] 返回成功消息

**响应示例**：
```json
{
    "message": "删除成功"
}
```

**参考模式**：用户删除 API 的模式（Day 19 第 349-370 行）

**预计时间**：1 小时

---

## Day 24（第三天）：文章列表分页 + 评论功能 API ⭐⭐⭐

### 任务1：实现文章列表 API（分页）

**接口**：`GET /api/posts?page=1&per_page=10`

**功能要求**：
- [ ] 支持分页参数（page, per_page）
- [ ] 返回分页后的文章列表
- [ ] 包含分页信息（总数、当前页、每页数量）

**查询参数**：
- `page`：页码（默认 1）
- `per_page`：每页数量（默认 10）

**响应示例**：
```json
{
    "count": 25,
    "page": 1,
    "per_page": 10,
    "total_pages": 3,
    "posts": [...]
}
```

**实现提示**：
```python
# 获取分页参数
page = request.args.get('page', 1, type=int)
per_page = request.args.get('per_page', 10, type=int)

# 分页查询
posts = Post.query.paginate(page=page, per_page=per_page, error_out=False)
```

**预计时间**：2-3 小时

---

### 任务2：实现添加评论 API

**接口**：`POST /api/posts/<post_id>/comments`

**功能要求**：
- [ ] 接收评论内容（content, author_id）
- [ ] 验证必填字段
- [ ] 验证文章是否存在
- [ ] 验证作者是否存在
- [ ] 创建新评论
- [ ] 返回评论信息

**请求示例**：
```json
{
    "content": "写得很好！",
    "author_id": 2
}
```

**参考模式**：创建文章 API 的模式

**预计时间**：1-2 小时

---

### 任务3：实现评论列表 API

**接口**：`GET /api/posts/<post_id>/comments`

**功能要求**：
- [ ] 验证文章是否存在
- [ ] 获取该文章的所有评论
- [ ] 返回评论列表

**响应示例**：
```json
{
    "count": 2,
    "comments": [
        {
            "id": 1,
            "content": "写得很好！",
            "post_id": 1,
            "author_id": 2
        },
        {
            "id": 2,
            "content": "学到了",
            "post_id": 1,
            "author_id": 2
        }
    ]
}
```

**预计时间**：1 小时

---

### 任务4：实现更新评论 API

**接口**：`PUT /api/comments/<id>`

**功能要求**：
- [ ] 验证评论是否存在
- [ ] 接收更新数据
- [ ] 更新评论内容
- [ ] 返回更新后的评论

**参考模式**：更新文章 API 的模式

**预计时间**：1 小时

---

### 任务5：实现删除评论 API

**接口**：`DELETE /api/comments/<id>`

**功能要求**：
- [ ] 验证评论是否存在
- [ ] 删除评论
- [ ] 返回成功消息

**参考模式**：删除文章 API 的模式

**预计时间**：1 小时

---

### 任务6：测试所有 API（使用 Postman）

**测试清单**：

#### 用户相关
- [ ] 用户注册（成功）
- [ ] 用户注册（失败：邮箱已存在）
- [ ] 用户登录（成功）
- [ ] 用户登录（失败：密码错误）

#### 文章相关
- [ ] 创建文章（成功）
- [ ] 获取文章列表（成功）
- [ ] 获取文章详情（成功）
- [ ] 获取文章详情（失败：文章不存在）
- [ ] 更新文章（成功）
- [ ] 删除文章（成功）

#### 评论相关
- [ ] 添加评论（成功）
- [ ] 获取评论列表（成功）
- [ ] 更新评论（成功）
- [ ] 删除评论（成功）

#### 分页功能
- [ ] 文章列表分页（第1页）
- [ ] 文章列表分页（第2页）
- [ ] 文章列表分页（自定义每页数量）

**预计时间**：2-3 小时

---

## 📊 任务进度跟踪

### Day 22 进度
- [ ] 用户注册 API
- [ ] 用户登录 API
- [ ] 测试用户注册和登录

### Day 23 进度
- [ ] 创建文章 API
- [ ] 文章列表 API
- [ ] 文章详情 API
- [ ] 更新文章 API
- [ ] 删除文章 API

### Day 24 进度
- [ ] 文章列表 API（分页）
- [ ] 添加评论 API
- [ ] 评论列表 API
- [ ] 更新评论 API
- [ ] 删除评论 API
- [ ] 测试所有 API

---

## 🎯 实现策略

### 1. 一个功能一个功能地完成

**不要一次性写所有代码**，而是：
1. 写一个 API
2. 测试这个 API
3. 确认没问题后，再写下一个

### 2. 从最简单的开始

**建议顺序**：
1. 用户注册（参考 Day 19）
2. 用户登录（参考 Day 19）
3. 文章列表（GET，最简单）
4. 文章详情（GET，简单）
5. 创建文章（POST）
6. 更新文章（PUT）
7. 删除文章（DELETE）
8. 评论相关 API
9. 分页功能

### 3. 参考 Day 19 的代码模式

**Day 19 已经实现了**：
- 用户注册/登录
- 用户 CRUD 操作

**你可以参考**：
- 代码结构
- 错误处理方式
- 数据验证方法
- 响应格式

---

## 📚 参考资源

### 代码文件
- `Day19_用户管理API_完整案例.py` - 完整的用户管理 API
- `用户注册登录_完整实现.py` - 用户注册和登录的完整代码
- `Day20-21_单文件版本.py` - 项目基础结构

### 文档
- `Day20-21_自主完成指南.md` - 详细的学习方法
- `Day22-24_核心功能开发指南.md` - 核心功能开发指南

---

## ✅ 完成标准

当你能够：
- ✅ 所有 API 都能正常响应
- ✅ 能够创建用户、文章、评论
- ✅ 能够查询、更新、删除数据
- ✅ 分页功能正常工作
- ✅ 使用 Postman 测试所有接口都成功

**恭喜！你已经完成了 Day 22-24 的所有任务！** 🎉

---

## 💡 重要提示

1. **不要完美主义**：先做出能用的功能，再优化
2. **遇到问题很正常**：每个程序员都会遇到问题
3. **解决问题就是学习**：每次解决问题，能力都会提升
4. **参考 Day 19**：你已经掌握了基础，可以参考 Day 19 的代码
5. **完成比完美更重要**：先完成所有功能，再考虑优化

---

**加油！你可以的！** 💪
