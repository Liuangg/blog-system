# Day 20-21: 项目规划 + 数据库设计

## ✅ 任务完成清单

- [x] 项目需求分析（博客系统后端）
- [x] 设计数据库模型（User, Post, Comment）
- [x] 创建项目结构
- [x] 配置Flask + SQLAlchemy
- [x] 创建数据库表

## 📋 项目需求分析

### 核心功能模块

#### 1. 用户管理模块
- **用户注册**: 新用户可以通过邮箱和密码注册
- **用户登录**: 已注册用户可以通过邮箱和密码登录
- **用户信息查询**: 可以查询用户的基本信息
- **用户信息更新**: 用户可以更新自己的信息

#### 2. 文章管理模块
- **创建文章**: 登录用户可以创建新文章
- **文章列表**: 可以查看所有文章列表（支持分页）
- **文章详情**: 可以查看单篇文章的详细内容
- **更新文章**: 作者可以更新自己的文章
- **删除文章**: 作者可以删除自己的文章

#### 3. 评论管理模块
- **添加评论**: 登录用户可以对文章添加评论
- **查看评论**: 可以查看某篇文章的所有评论
- **更新评论**: 评论者可以更新自己的评论
- **删除评论**: 评论者可以删除自己的评论

## 📊 数据库设计

### 表结构设计

#### 1. users 表（用户表）

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 用户ID |
| username | VARCHAR(50) | UNIQUE, NOT NULL | 用户名 |
| email | VARCHAR(100) | UNIQUE, NOT NULL | 邮箱 |
| password | VARCHAR(100) | NOT NULL | 密码 |
| created_at | DATETIME | DEFAULT NOW() | 创建时间 |
| updated_at | DATETIME | DEFAULT NOW() | 更新时间 |

#### 2. posts 表（文章表）

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 文章ID |
| title | VARCHAR(200) | NOT NULL | 文章标题 |
| content | TEXT | NOT NULL | 文章内容 |
| author_id | INT | FOREIGN KEY(users.id) | 作者ID |
| created_at | DATETIME | DEFAULT NOW() | 创建时间 |
| updated_at | DATETIME | DEFAULT NOW() | 更新时间 |

#### 3. comments 表（评论表）

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 评论ID |
| content | TEXT | NOT NULL | 评论内容 |
| post_id | INT | FOREIGN KEY(posts.id) | 文章ID |
| author_id | INT | FOREIGN KEY(users.id) | 评论者ID |
| created_at | DATETIME | DEFAULT NOW() | 创建时间 |
| updated_at | DATETIME | DEFAULT NOW() | 更新时间 |

### 关系设计

```
User (1) ────< (N) Post
  │
  │ (1)
  │
  └───< (N) Comment

Post (1) ────< (N) Comment
```

**关系说明**：
- **User ↔ Post**: 一对多（一个用户可以有多篇文章）
- **User ↔ Comment**: 一对多（一个用户可以发表多个评论）
- **Post ↔ Comment**: 一对多（一篇文章可以有多个评论）

### 外键约束

- `posts.author_id` → `users.id` (ON DELETE CASCADE)
- `comments.post_id` → `posts.id` (ON DELETE CASCADE)
- `comments.author_id` → `users.id` (ON DELETE CASCADE)

## 📁 项目结构

```
blog_system/
├── README.md                      # 项目说明文档
├── requirements.txt               # 依赖包列表
├── config.py                      # 配置文件
├── app.py                         # 主应用入口
├── models.py                      # 数据库模型
├── Day20-21_项目规划与数据库设计.md  # 本文档
├── routes/                        # 路由模块（后续添加）
│   ├── __init__.py
│   ├── users.py                  # 用户相关路由
│   ├── posts.py                  # 文章相关路由
│   └── comments.py               # 评论相关路由
└── utils/                         # 工具函数（后续添加）
    ├── __init__.py
    └── validators.py             # 数据验证函数
```

## 🔧 配置说明

### 数据库配置

在 `config.py` 中配置数据库连接：

```python
SQLALCHEMY_DATABASE_URI = 'mysql+pymysql://root:root123@localhost:3306/blog_system'
```

**注意**：请根据你的实际数据库配置修改连接信息。

### 依赖安装

```bash
pip install -r requirements.txt
```

## 🚀 初始化数据库

运行 `app.py` 会自动创建数据库表：

```bash
python app.py
```

首次运行会：
1. 连接到 MySQL 数据库
2. 创建 `blog_system` 数据库（如果不存在）
3. 创建三个表：`users`、`posts`、`comments`

## 📝 下一步计划（Day 22-24）

### 核心功能开发

1. **用户管理 API**
   - [ ] 实现用户注册接口
   - [ ] 实现用户登录接口
   - [ ] 实现用户信息查询接口
   - [ ] 实现用户信息更新接口

2. **文章管理 API**
   - [ ] 实现创建文章接口
   - [ ] 实现文章列表接口（支持分页）
   - [ ] 实现文章详情接口
   - [ ] 实现更新文章接口
   - [ ] 实现删除文章接口

3. **评论管理 API**
   - [ ] 实现添加评论接口
   - [ ] 实现评论列表接口
   - [ ] 实现更新评论接口
   - [ ] 实现删除评论接口

4. **测试**
   - [ ] 使用 Postman 测试所有 API
   - [ ] 验证数据关系是否正确

## 💡 重要提示

1. **密码安全**: 当前版本密码未加密，后续需要添加密码哈希功能
2. **数据验证**: 所有 API 都需要进行输入数据验证
3. **错误处理**: 需要完善的错误处理机制
4. **关系维护**: 删除用户或文章时，需要考虑级联删除评论

## ✅ 完成检查

- [x] 项目需求分析完成
- [x] 数据库模型设计完成
- [x] 项目结构创建完成
- [x] Flask + SQLAlchemy 配置完成
- [x] 数据库表创建脚本完成

**Day 20-21 任务完成！可以开始 Day 22-24 的核心功能开发了！** 🎉
